<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <title>JOB 369° — пошук роботи та вакансій</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover,user-scalable=no"/>
  <meta name="format-detection" content="telephone=no"/>
  <meta name="theme-color" content="#07142e"/>
  <link href="https://fonts.googleapis.com/css2?family=Russo+One&family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg: radial-gradient(1100px 800px at 50% 10%, #0a1f44 0%, #081939 42%, #07142e 100%);
      --paper:#fff; --ink:#000;
      --brand:#ffd33b; --brand-press:#ffbf00;
      --line:rgba(255,255,255,.14); --glass:rgba(12,20,44,.68);
      --field-bg:rgba(255,255,255,.08); --field-br:rgba(255,255,255,.22);
      --ph:rgba(255,255,255,.75);
      --menu-bg:#0b1635; --menu-br:rgba(255,255,255,.22); --menu-hover:rgba(255,255,255,.10);
      --top:60px;
    }
    *{box-sizing:border-box; -webkit-tap-highlight-color:transparent}
    html,body{height:100%}
    body{margin:0; background:var(--bg); color:var(--paper); font-family:"Montserrat",system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif;}

    /* Topbar */
    .topbar{ position:sticky; top:0; z-index:100; height:var(--top); display:flex; align-items:center; gap:10px; padding:10px 12px; background:linear-gradient(180deg, rgba(7,15,35,.95), rgba(7,15,35,.72)); border-bottom:1px solid var(--line); }
    .logo{background:var(--brand); color:#111; border-radius:12px; padding:8px 12px; font:700 16px/1 "Russo One",sans-serif;}
    .pill{display:inline-flex; align-items:center; gap:8px; height:38px; padding:0 12px; border-radius:12px; border:1px solid var(--line); background:rgba(255,255,255,.08); cursor:pointer; font-weight:700;}
    .pill.yellow{background:var(--brand); color:#111; border-color:rgba(0,0,0,.2); font-family:"Russo One"; text-transform:uppercase;}
    .grow{flex:1}

    .container{max-width:1200px; margin:12px auto; padding:0 12px;}
    .panel{background:var(--glass); border:1px solid var(--line); border-radius:16px; padding:12px; box-shadow:0 20px 40px rgba(0,0,0,.45); backdrop-filter:saturate(130%) blur(8px);}    

    /* Inputs */
    .filters{display:grid; grid-template-columns:repeat(6,1fr); gap:10px;}
    @media (max-width:1024px){ .filters{grid-template-columns:repeat(3,1fr);} }
    @media (max-width:640px){ .filters{grid-template-columns:1fr 1fr;} }
    label{font-size:12px; font-weight:800; opacity:.92; display:block; margin:0 0 6px;}
    .input,.select{ width:100%; height:46px; border-radius:12px; border:1px solid var(--field-br); background:var(--field-bg); color:#fff; padding:0 12px; font-size:14px; outline:none; }
    .input::placeholder{color:var(--ph)}
    .actions{display:flex; gap:10px; margin-top:10px; flex-wrap:wrap}
    .btn{height:48px; border:none; border-radius:14px; background:var(--brand); color:#111; font:700 16px/48px "Russo One"; padding:0 18px; cursor:pointer; box-shadow:0 6px 0 rgba(0,0,0,.35), inset 0 -3px 0 rgba(0,0,0,.18);}    
    .btn:active{transform:translateY(2px); background:var(--brand-press); box-shadow:0 4px 0 rgba(0,0,0,.35), inset 0 -2px 0 rgba(0,0,0,.18);}    
    .btn.ghost{background:rgba(255,255,255,.1); color:#fff;}

    /* Nice Select (desktop) — PORTAL OVERLAY */
    @media (hover:hover){
      .select.nice-hidden{position:absolute; inset:0; opacity:0; pointer-events:none}
      .nice{position:relative}
      .nice-btn{ width:100%; height:46px; border-radius:12px; border:1px solid var(--field-br); background:var(--field-bg); color:#fff; padding:0 38px 0 12px; text-align:left; font-size:14px; font-weight:600; cursor:pointer; }
      .nice-btn:after{content:"▾"; position:absolute; right:12px; top:50%; transform:translateY(-50%); opacity:.8; pointer-events:none}
      /* moved to body */
      .nice-list{ position:fixed; left:0; top:0; width:260px; background:var(--menu-bg); border:1px solid var(--menu-br); border-radius:12px; padding:6px; box-shadow:0 18px 38px rgba(0,0,0,.6); display:none; max-height:260px; overflow:auto; z-index:2147483647; }
      .nice-item{padding:10px 12px; border-radius:10px; cursor:pointer; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
      .nice-item:hover{background:var(--menu-hover)}
      .nice-item.active{background:rgba(255,255,255,.12)}
    }

    .topline{display:flex; align-items:center; gap:10px; margin:14px 0;}
    .grid{display:grid; grid-template-columns:repeat(3,1fr); gap:12px;}
    @media (max-width:1024px){ .grid{grid-template-columns:repeat(2,1fr);} }
    @media (max-width:640px){ .grid{grid-template-columns:1fr;} }

    .card{ background:rgba(255,255,255,.06); border:1px solid var(--line); border-radius:14px; overflow:hidden; display:flex; flex-direction:column; cursor:pointer; transition:transform .08s ease, box-shadow .08s ease; }
    .card:active{transform:translateY(1px); box-shadow:0 10px 22px rgba(0,0,0,.35)}
    .thumb{position:relative; padding-top:62%; background:#0b3a8a; overflow:hidden;}
    .thumb img{position:absolute; inset:0; width:100%; height:100%; object-fit:cover;}
    .badge{position:absolute; left:8px; bottom:8px; background:var(--brand); color:#111; border-radius:10px; padding:6px 10px; font:700 14px/1 "Russo One";}
    .views{position:absolute; right:8px; bottom:8px; background:rgba(0,0,0,.6); border:1px solid rgba(255,255,255,.25); color:#fff; border-radius:10px; padding:5px 8px; font-weight:700; font-size:12px}
    .body{padding:10px; display:flex; flex-direction:column; gap:6px}
    .title{font:700 16px/1.2 "Russo One"; letter-spacing:.4px}

    .detail{position:fixed; inset:0; z-index:120; display:none; background:rgba(0,0,0,.5);}    
    .detail.active{display:block;}
    .sheet{position:absolute; left:50%; top:6vh; transform:translateX(-50%); width:min(1080px,96vw); max-height:88vh; overflow:auto; background:var(--glass); border:1px solid var(--line); border-radius:16px; padding:12px; box-shadow:0 20px 40px rgba(0,0,0,.6); backdrop-filter:saturate(130%) blur(8px);}    

    /* Single-image gallery with arrows (логотип/банер) */
    .big{position:relative; padding-top:40%; background:#0b3a8a; border-radius:12px; overflow:hidden}
    .big img{position:absolute; inset:0; width:100%; height:100%; object-fit:cover}
    .navBtn{position:absolute; top:50%; transform:translateY(-50%); background:rgba(0,0,0,.45); color:#fff; border:1px solid rgba(255,255,255,.25); height:42px; padding:0 12px; border-radius:12px; font-weight:800; cursor:pointer}
    .navBtn:hover{background:rgba(0,0,0,.6)}
    .navPrev{left:8px}
    .navNext{right:8px}

    .chips{display:flex; flex-wrap:wrap; gap:8px; margin:8px 0}
    .chip{background:rgba(255,255,255,.12); border:1px solid var(--line); border-radius:999px; padding:6px 10px; font-size:12px; font-weight:700}

    .specs{display:grid; grid-template-columns:repeat(3,1fr); gap:8px}
    @media (max-width:900px){ .specs{grid-template-columns:repeat(2,1fr);} }
    .spec{background:rgba(255,255,255,.06); border:1px solid var(--line); border-radius:12px; padding:8px; font-size:13px}
    .h{font:700 14px/1 "Russo One"; margin-bottom:6px}
    .divider{height:1px; background:var(--line); margin:10px 0}
    .seller{display:flex; gap:10px; align-items:center}
    .avatar{width:44px; height:44px; border-radius:50%; background:#203157; display:flex; align-items:center; justify-content:center; font-weight:800}

    /* Pager at bottom */
    .pager{display:flex; justify-content:center; margin:16px 0 40px}

    /* Hide attribution area */
    #dAttribution{display:none}
  </style>
</head>
<body>
  <header class="topbar">
    <div class="logo">JOB 369°</div>
    <div class="pill yellow" id="tabSearch">Пошук</div>
    <div class="pill" id="tabPost">Додати вакансію</div>
    <div class="grow"></div>
    <!-- імпорт-кнопки ВІДСУТНІ за побажанням -->
  </header>

  <main class="container">
    <!-- ФІЛЬТРИ -->
    <section class="panel" id="searchPanel">
      <div class="filters" id="filters">
        <div><label>Місто</label><select class="select" id="fltCity"></select></div>
        <div><label>Категорія</label><select class="select" id="fltCat"></select></div>
        <div><label>Компанія</label><select class="select" id="fltCompany"></select></div>
        <div><label>Досвід</label><select class="select" id="fltExp"></select></div>
        <div><label>Зайнятість</label><select class="select" id="fltEmployment"></select></div>
        <div><label>Формат роботи</label><select class="select" id="fltRemote"></select></div>
        <div><label>Зарплата від</label><input class="input" id="fltSalaryMin" placeholder="0"></div>
        <div><label>Зарплата до</label><input class="input" id="fltSalaryMax" placeholder="∞"></div>
        <div><label>Валюта</label><select class="select" id="fltCur"></select></div>
        <div><label>Пошук (посада / навички)</label><input class="input" id="fltQuery" placeholder="напр., менеджер, React, водій"></div>
        <div class="check"><input type="checkbox" id="fltRecent"> <label for="fltRecent">За 30 днів</label></div>
      </div>
      <div class="actions">
        <button class="btn" id="btnApply">Знайти</button>
        <button class="btn ghost" id="btnReset">Скинути</button>
        <select class="select" id="sortBy" style="max-width:240px">
          <option value="new">Сортувати: нові</option>
          <option value="salaryAsc">Зарплата ↑</option>
          <option value="salaryDesc">Зарплата ↓</option>
          <option value="expDesc">Досвід: Senior→Junior</option>
          <option value="viewsDesc">Перегляди ↓</option>
        </select>
      </div>
    </section>

    <!-- РЕЗУЛЬТАТИ -->
    <section class="topline">
      <div id="resCount" class="muted">0 результатів</div>
      <div class="grow"></div>
    </section>
    <section class="grid" id="grid"></section>
    <div class="pager"><button class="btn" id="btnMore" style="display:none">Показати ще</button></div>

    <!-- ДОДАТИ ВАКАНСІЮ -->
    <section id="postPanel" class="panel" style="display:none; margin-top:14px">
      <h3 style="margin:0 0 8px; font:700 18px/1 'Russo One'">Додати вакансію</h3>
      <div class="filters" style="grid-template-columns:repeat(3,1fr)">
        <div><label>Компанія</label><input class="input" id="pCompany" placeholder="ТОВ \"Приклад\""></div>
        <div><label>Посада</label><input class="input" id="pTitle" placeholder="Менеджер з продажу"></div>
        <div><label>Місто</label><select class="select" id="pCity"></select></div>
        <div><label>Категорія</label><select class="select" id="pCat"></select></div>
        <div><label>Досвід</label><select class="select" id="pExp"></select></div>
        <div><label>Зайнятість</label><select class="select" id="pEmployment"></select></div>
        <div><label>Формат роботи</label><select class="select" id="pRemote"></select></div>
        <div><label>Зарплата від</label><input class="input" id="pSalaryMin" placeholder="15000"></div>
        <div><label>Зарплата до</label><input class="input" id="pSalaryMax" placeholder="35000"></div>
        <div><label>Валюта</label><select class="select" id="pCur"></select></div>
        <div style="grid-column:1/-1"><label>Опис</label><textarea class="input" id="pDesc" rows="3" style="height:auto; padding:10px" placeholder="Обов'язки, умови, бонуси... (≥ 20 символів)"></textarea></div>
        <div style="grid-column:1/-1"><label>Вимоги</label><textarea class="input" id="pReq" rows="3" style="height:auto; padding:10px" placeholder="Список через крапку з комою: комунікабельність; досвід з CRM; права категорії B..."></textarea></div>
        <div><label>Телефон</label><input class="input" id="pPhone" placeholder="+380..."></div>
        <div><label>Email</label><input class="input" id="pEmail" placeholder="hr@company.ua"></div>
        <div><label>Telegram</label><input class="input" id="pTG" placeholder="@company_hr"></div>
      </div>
      <div class="actions">
        <button class="btn" id="pSave">Опублікувати</button>
        <div class="muted">Антиспам: 1 вакансія / 60 сек.</div>
      </div>
    </section>
  </main>

  <!-- DETAIL -->
  <div id="detail" class="detail">
    <div class="sheet">
      <div style="display:flex; gap:8px; align-items:center; margin-bottom:8px">
        <div class="logo">JOB 369°</div>
        <div class="grow"></div>
        <button class="btn close" id="dClose" style="height:38px; line-height:38px; border-radius:12px; font:700 13px/38px 'Russo One'">Закрити</button>
      </div>
      <div id="dHeader" style="display:flex; align-items:center; gap:10px; margin-bottom:8px"></div>
      <div id="dGal"></div>
      <div class="chips" id="dChips"></div>
      <div class="divider"></div>
      <div class="specs" id="dSpecs"></div>
      <div class="divider"></div>
      <div id="dDesc" class="muted"></div>
      <div class="divider"></div>
      <div id="dReq" class="muted"></div>
      <div class="divider"></div>
      <div class="seller" id="dSeller"></div>
      <div id="dAttribution" class="muted" style="margin-top:8px; font-size:12px; opacity:.8"></div>
    </div>
  </div>

  <script>
  const $ = s => document.querySelector(s), $$ = s => document.querySelectorAll(s);
  const DB_KEY = "job369_listings", CTRL_KEY = "job369_ctrl";

  // === Довідники ===
  const CITIES=["Київ","Харків","Одеса","Дніпро","Львів","Запоріжжя","Кривий Ріг","Миколаїв","Вінниця","Херсон","Полтава","Чернігів","Черкаси","Суми","Житомир","Хмельницький","Чернівці","Рівне","Івано-Франківськ","Тернопіль","Луцьк","Ужгород","Кропивницький","Кам'янське","Кременчук","Біла Церква","Бровари","Бориспіль","Ірпінь","Буча"];  
  const CATS=["IT","Продажі","Маркетинг","Логістика","Будівництво","Медицина","Освіта","Виробництво","Обслуговування","Бухгалтерія","Юриспруденція","Держсектор","Фриланс","Інше"];
  const EXP=["Без досвіду","Junior","Middle","Senior","Lead"];
  const EMP=["Повна зайнятість","Неповна","Проєктна/Контракт","Стажування"];
  const REMOTE=["Офіс","Гібрид","Віддалено"];
  const CUR=["₴","$","€"];
  const COMPANIES = [
    "SoftUA","NovaMarket","GreenLine Logistics","БудПро Груп","MedLife Україна","SchoolPro","AutoParts UA","BluePay","SkyNet Studio","Legal&Co","FinMaster","CleanCity","FoodTech UA","RetailMix","AgroLine","TravelFox","BuildArt","DataForge","CloudNest","SeaPort Сервіс","ДоброСад","Метрологія+","Охорона-Сервіс","EcoPack","MetroLab","Sun&Coffee","BestCall","MegaPrint","Smart Clinic","IT Craft UA","ТранспортЛайн","CityHotel","Дом Сервіс","Take&Go","Kredo Bank UA","ЮрКонсулт","Візія Медія","ДистриБУТ","Академія Z","Prosales Team","ЕнергоСвіт"
  ];

  const getDB=()=>{try{return JSON.parse(localStorage.getItem(DB_KEY)||"[]")}catch{return[]}}; const setDB=v=>localStorage.setItem(DB_KEY,JSON.stringify(v)); const getCtrl=()=>{try{return JSON.parse(localStorage.getItem(CTRL_KEY)||"{}") }catch{return{}}}; const setCtrl=v=>localStorage.setItem(CTRL_KEY,JSON.stringify(v));
  const uid=()=>Math.random().toString(16).slice(2)+Date.now().toString(16); const rand=(a,b)=>Math.floor(Math.random()*(b-a+1))+a; const pick=a=>a[rand(0,a.length-1)];

  // === Плейсхолдер логотип / банер ===
  function logoPNG(text, seed=0){ const c=document.createElement('canvas'); c.width=800; c.height=400; const g=c.getContext('2d'); const palettes=[["#14233b","#254a7a"],["#3a1f5d","#6b3aa3"],["#0b3a2e","#1b8c73"],["#6b1f1f","#a23333"],["#0b2a4a","#0f5c99"],["#2b2b2b","#595959"]]; const pal=palettes[seed%palettes.length]; const grad=g.createLinearGradient(0,0,800,400); grad.addColorStop(0,pal[0]); grad.addColorStop(1,pal[1]); g.fillStyle=grad; g.fillRect(0,0,800,400); // initials
    const initials = text.split(/\s+/).map(w=>w[0]).join('').slice(0,3).toUpperCase(); g.fillStyle="#ffd33b"; g.font="bold 140px 'Russo One', Arial"; g.textAlign="center"; g.textBaseline="middle"; g.fillText(initials, 400, 210); return c.toDataURL('image/png'); }
  function bannerPNG(title, seed=0){ const c=document.createElement('canvas'); c.width=800; c.height=320; const g=c.getContext('2d'); const colors=[["#0e2a58","#163b7a"],["#3a1f5d","#532e8a"],["#0b3a2e","#147a60"],["#6b1f1f","#a23333"]]; const pal=colors[seed%colors.length]; const grad=g.createLinearGradient(0,0,800,320); grad.addColorStop(0,pal[0]); grad.addColorStop(1,pal[1]); g.fillStyle=grad; g.fillRect(0,0,800,320); g.fillStyle="#ffd33b"; g.font="bold 54px 'Russo One', Arial"; g.textAlign="center"; g.fillText(title, 400, 180); return c.toDataURL('image/png'); }
  function createImg(src, alt, fallback){ const img=document.createElement("img"); img.loading="lazy"; img.alt=alt; img.referrerPolicy="no-referrer"; img.src = src || fallback; img.onerror=()=>{ img.onerror=null; img.src=fallback; }; return img; }

  // === Генерація синтетичної БД вакансій (2000+) ===
  function seedDB(){ const out=[]; const skillsPool=["Excel","Word","CRM","1C","English B1","English B2","SQL","Python","JavaScript","React","Node.js","Docker","Linux","Sales","Cold calls","SMM","Google Ads","Meta Ads","Copywriting","Logistics","CAD","AutoCAD","Driving B","Medicine","Nursing","HTML/CSS","Figma","QA","Manual QA","Automation QA","KPI","Negotiation","Team lead","Project mgmt","Accounting","Tax","Law","Customer care","Photoshop","Illustrator"]; for(let i=0;i<2200;i++){ const city=CITIES[i%CITIES.length]; const cat=CATS[i%CATS.length]; const company=COMPANIES[i%COMPANIES.length]; // title by category
      const titles={
        IT:["Frontend Developer","Backend Developer","Fullstack Developer","QA Engineer","DevOps Engineer","Data Analyst"],
        Продажі:["Менеджер з продажу","Sales Representative","Керівник відділу продажів"],
        Маркетинг:["Маркетолог","SMM-спеціаліст","Контент-менеджер","PPC-спеціаліст"],
        Логістика:["Логіст","Координатор доставок","Водій-експедитор"],
        Будівництво:["Інженер-будівельник","Архітектор","Прораб"],
        Медицина:["Медсестра","Лікар-терапевт","Фельдшер"],
        Освіта:["Викладач","Вчитель","Тренер"],
        Виробництво:["Оператор лінії","Слюсар","Електрик"],
        Обслуговування:["Офіціант","Бариста","Адміністратор залу"],
        Бухгалтерія:["Бухгалтер","Фінансовий аналітик","Аудитор"],
        Юриспруденція:["Юрисконсульт","Адвокат-помічник","Нотаріальний помічник"],
        Держсектор:["Фахівець ЦНАП","Документообіг","Адміністратор послуг"],
        Фриланс:["Копірайтер","Дизайнер","Верстальник"],
        Інше:["Менеджер","Асистент","Координатор"]
      };
      const t = titles[cat][rand(0,titles[cat].length-1)];
      const exp = EXP[rand(0, EXP.length-1)];
      const employment = EMP[rand(0, EMP.length-1)];
      const remote = REMOTE[rand(0, REMOTE.length-1)];
      const cur = CUR[rand(0, CUR.length-1)];
      // salary by cat & exp (rough synthetic logic)
      let base = 15000; if(cat==="IT") base=30000; if(cat==="Бухгалтерія"||cat==="Юриспруденція") base=22000; if(cat==="Обслуговування") base=12000; if(cat==="Будівництво"||cat==="Виробництво") base=18000; if(remote==="Віддалено" && cat==="IT") base+=10000;
      const levelBoost = {"Без досвіду":0, "Junior":0.2, "Middle":0.6, "Senior":1.2, "Lead":1.5}[exp];
      let sMin = Math.round(base*(1+levelBoost)); let sMax = Math.round(sMin*1.4);
      // convert to currency
      if(cur==="$" ){ sMin=Math.round(sMin/40); sMax=Math.round(sMax/40); }
      if(cur==="€" ){ sMin=Math.round(sMin/43); sMax=Math.round(sMax/43); }
      const skills = Array.from({length:rand(3,7)},()=>pick(skillsPool));
      const posted = Date.now() - rand(0, 60*86400*1000);
      const desc = "Компанія "+company+" шукає "+t+" у місті "+city+". Конкурентна оплата, дружня команда, офіційне працевлаштування.";
      const req = skills.slice(0,rand(2,skills.length)).join("; ");
      out.push({ id:uid(), city, category:cat, title:t, company, exp, employment, remote, salaryMin:sMin, salaryMax:sMax, currency:cur, posted, views:rand(50,800), skills, desc, req, contacts:{ phone:"+380"+rand(500000000,999999999), email:"hr@"+company.toLowerCase().replace(/[^a-zа-яіїє0-9]+/gi,'')+".ua", tg:"@"+company.toLowerCase().replace(/\s+/g,'_')+"_hr" }, images:[] });
    }
    localStorage.setItem(DB_KEY, JSON.stringify(out));
  }
  if(getDB().length===0) seedDB();

  // ==== Ініціалізація селектів
  function fillSelect(el, arr, withAll=true, txt="Будь-який"){ el.innerHTML=(withAll?`<option value="">${txt}</option>`:'')+arr.map(x=>`<option value="${x}">${x}</option>`).join(''); }
  const fltCity=$("#fltCity"), fltCat=$("#fltCat"), fltCompany=$("#fltCompany"), fltExp=$("#fltExp"), fltEmployment=$("#fltEmployment"), fltRemote=$("#fltRemote"), fltSalaryMin=$("#fltSalaryMin"), fltSalaryMax=$("#fltSalaryMax"), fltCur=$("#fltCur"), fltQuery=$("#fltQuery"), fltRecent=$("#fltRecent");
  fillSelect(fltCity,CITIES); fillSelect(fltCat,CATS); fillSelect(fltExp,EXP); fillSelect(fltEmployment,EMP); fillSelect(fltRemote,REMOTE); fillSelect(fltCur,[...CUR],true,"Будь-яка");
  // Компанії з БД (унікальні)
  function refreshCompanyOptions(){ const names=[...new Set(getDB().map(x=>x.company))].sort(); fillSelect(fltCompany,names,true,"Будь-яка"); }
  refreshCompanyOptions();

  // Форма "Додати вакансію"
  const mapSel={pCity:CITIES,pCat:CATS,pExp:EXP,pEmployment:EMP,pRemote:REMOTE,pCur:[...CUR]}; Object.keys(mapSel).forEach(id=>fillSelect($(`#${id}`), mapSel[id], false));

  // ===== Custom select with portal overlay =====
  let activeList=null, activeWrap=null;
  function closeAll(e){ if(activeList){ if(e && (activeList.contains(e.target) || activeWrap.contains(e.target))) return; activeList.style.display='none'; activeWrap.appendChild(activeList); activeList=null; activeWrap=null; } }
  document.addEventListener('click', closeAll);
  document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeAll(); });

  function enhanceSelect(sel){ if (matchMedia('(hover: none)').matches) return; const wrap=document.createElement('div'); wrap.className='nice'; const btn=document.createElement('button'); btn.type='button'; btn.className='nice-btn'; const list=document.createElement('div'); list.className='nice-list'; const opts=[...sel.options]; function refreshBtn(){ btn.textContent = opts[sel.selectedIndex]?.text || (sel.getAttribute('data-placeholder')||'Виберіть'); } opts.forEach((o, idx)=>{ const it=document.createElement('div'); it.className='nice-item'+(o.selected?' active':''); it.textContent=o.text; it.onclick=(ev)=>{ ev.stopPropagation(); sel.selectedIndex=idx; refreshBtn(); [...list.children].forEach(c=>c.classList.remove('active')); it.classList.add('active'); closeAll(); sel.dispatchEvent(new Event('change')); }; list.appendChild(it); }); sel.classList.add('nice-hidden'); sel.parentNode.insertBefore(wrap, sel); wrap.appendChild(sel); wrap.appendChild(btn); refreshBtn(); function open(){ closeAll(); const r=btn.getBoundingClientRect(); list.style.left = r.left+'px'; list.style.top = (r.bottom+6)+'px'; list.style.width = r.width+'px'; list.style.display='block'; document.body.appendChild(list); activeList=list; activeWrap=wrap; }
    btn.onclick=(e)=>{ e.stopPropagation(); if(activeList===list){ closeAll(); } else { open(); } };
  }
  $$('.select').forEach(enhanceSelect);

  // ==== Пошук/рендер
  const grid=$("#grid"), resCount=$("#resCount"), btnMore=$("#btnMore"), sortBy=$("#sortBy");
  let page=0, pageSize=24, lastResults=[];

  const EXP_ORDER={"Без досвіду":0, Junior:1, Middle:2, Senior:3, Lead:4};

  function applyFilters(){ const q=(fltQuery.value||"").trim().toLowerCase(); const smin= +( (fltSalaryMin.value||0) ); const smax= +( (fltSalaryMax.value||0) ); const cur=fltCur.value; let arr=getDB().filter(it=> (!fltCity.value || it.city===fltCity.value) && (!fltCat.value || it.category===fltCat.value) && (!fltCompany.value || it.company===fltCompany.value) && (!fltExp.value || it.exp===fltExp.value) && (!fltEmployment.value || it.employment===fltEmployment.value) && (!fltRemote.value || it.remote===fltRemote.value) && (!smin || it.salaryMax>=smin) && (!smax || it.salaryMin<=smax) && (!cur || it.currency===cur) && (!q || ( (it.title+" "+it.company+" "+(it.skills||[]).join(" ")+" "+(it.desc||"")).toLowerCase().includes(q) )) && (!fltRecent.checked || (Date.now()-it.posted)<=30*86400*1000) );
    arr.sort((a,b)=>{ switch(sortBy.value){ case "salaryAsc": return (a.salaryMin||0)-(b.salaryMin||0); case "salaryDesc": return (b.salaryMax||0)-(a.salaryMax||0); case "expDesc": return (EXP_ORDER[b.exp]||0)-(EXP_ORDER[a.exp]||0); case "viewsDesc": return (b.views||0)-(a.views||0); default: return b.posted-a.posted; } });
    lastResults=arr; page=0; grid.innerHTML=""; resCount.textContent=`${arr.length} результатів`; renderMore(); }
  function remainingCount(){ return Math.max(0, lastResults.length - page*pageSize); }
  function updateMoreUI(){ btnMore.style.display = remainingCount()>0 ? "inline-flex" : "none"; }
  function renderMore(){ const slice=lastResults.slice(page*pageSize,(page+1)*pageSize); slice.forEach(renderCard); page++; updateMoreUI(); }
  function kFmt(n){ if(n>=1000) return (n/1000).toFixed(1).replace(/\.0$/,'')+"k"; return n+""; }
  function renderCard(it){ const el=document.createElement('article'); el.className="card"; el.setAttribute('role','button'); el.title="Дивитися"; const fallback=logoPNG(it.company, (it.title+it.company).length%6); const salary = (it.salaryMin&&it.salaryMax)? `${it.salaryMin.toLocaleString('uk-UA')}–${it.salaryMax.toLocaleString('uk-UA')} ${it.currency}` : "Договірна"; el.innerHTML=`<div class="thumb"><div class="badge">${salary}</div><div class="views">👁 ${kFmt(it.views||0)}</div></div><div class="body"><div class="title">${it.title} • ${it.company}</div><div class="meta">${it.city} • ${it.category}</div><div class="meta">${it.employment} • ${it.remote} • ${it.exp}</div></div>`; el.querySelector(".thumb").prepend(createImg((it.images&&it.images[0])||null, `${it.title} ${it.company}`, fallback)); el.onclick=()=>openDetail(it.id); grid.appendChild(el); }
  let applyLock=false; $("#btnApply").onclick=()=>{ if(applyLock) return; applyLock=true; applyFilters(); setTimeout(()=>applyLock=false, 600); }; $("#btnReset").onclick=()=>{ $$("#searchPanel .select, #searchPanel .input").forEach(x=>x.value=""); fltRecent.checked=false; applyFilters(); }; btnMore.onclick=renderMore; sortBy.onchange=applyFilters; applyFilters();

  // ===== Детальна + simple slider =====
  function chip(t){return `<span class="chip">${t}</span>`}
  let galIndex=0, galImgs=[]; function renderGallery(title){ const gal=$("#dGal"); gal.innerHTML=`<div class="big"><button class="navBtn navPrev" id="galPrev">‹</button><button class="navBtn navNext" id="galNext">›</button></div>`; const big=gal.querySelector('.big'); const url=galImgs[galIndex]; big.appendChild(createImg(url, 'banner', bannerPNG(title,galIndex))); $("#galPrev").onclick=()=>{ galIndex=(galIndex-1+galImgs.length)%galImgs.length; renderGallery(title); }; $("#galNext").onclick=()=>{ galIndex=(galIndex+1)%galImgs.length; renderGallery(title); }; }
  document.addEventListener('keydown', (e)=>{ if($("#detail").classList.contains('active')){ if(e.key==='ArrowLeft') $("#galPrev")?.click(); if(e.key==='ArrowRight') $("#galNext")?.click(); if(e.key==='Escape') $("#dClose")?.click(); }});

  function openDetail(id){ const db=getDB(); const idx=db.findIndex(x=>x.id===id); if(idx<0) return; const it=db[idx]; it.views=(it.views||0)+1; db[idx]=it; setDB(db); const d=$("#detail"); d.classList.add('active'); $("#dClose").onclick=()=>{ d.classList.remove('active'); applyFilters(); }; const salary = (it.salaryMin&&it.salaryMax)? `${it.salaryMin.toLocaleString('uk-UA')}–${it.salaryMax.toLocaleString('uk-UA')} ${it.currency}` : "Договірна"; $("#dHeader").innerHTML=`<div class="title" style="font:700 20px/1.2 'Russo One'">${it.title} — ${it.company}</div><div class="pill yellow">${salary}</div><div class="pill" style="margin-left:auto">👁 ${it.views}</div>`; const imgs=(Array.isArray(it.images)&&it.images.length)?it.images:[]; const logo = logoPNG(it.company, (it.title+it.company).length%6); galImgs = (imgs.length? imgs : [logo, bannerPNG(it.title,1), bannerPNG(it.company,2)]); galIndex=0; renderGallery(`${it.title}`);
    $("#dChips").innerHTML = chip(it.city)+chip(it.category)+chip(it.employment)+chip(it.remote)+chip(it.exp);
    function spec(k,v){return `<div class="spec"><div class="h">${k}</div>${v}</div>`}
    $("#dSpecs").innerHTML= spec("Опубліковано", new Date(it.posted).toLocaleDateString('uk-UA'))+ spec("Місто", it.city)+ spec("Категорія", it.category)+ spec("Зайнятість", it.employment)+ spec("Формат", it.remote)+ spec("Досвід", it.exp)+ spec("Навички", (it.skills||[]).join(', '));
    $("#dDesc").textContent = it.desc||""; $("#dReq").innerHTML = `<div class="h">Вимоги</div>` + ( (it.req||"").split(/;\s*/).map(x=>x?`• ${x}`:"").join('<br>') );
    $("#dSeller").innerHTML=`<div class="avatar">${(it.company||"C")[0]}</div><div><div class="h">Контакти</div><div>${it.company}</div><div class="small">${it.contacts?.phone||""} • ${it.contacts?.email||""} • ${it.contacts?.tg||""}</div></div>`; }

  // Публікація вакансії
  $("#pSave").onclick=()=>{ const ctrl=getCtrl(); const now=Date.now(); if(ctrl.lastPost && now-ctrl.lastPost<60000){ alert("Публікувати можна не частіше 1 разу на 60 сек."); return; } const company=$("#pCompany").value.trim(); const title=$("#pTitle").value.trim(); const city=$("#pCity").value; const category=$("#pCat").value; const exp=$("#pExp").value; const employment=$("#pEmployment").value; const remote=$("#pRemote").value; if(!company||!title||!city||!category||!exp||!employment||!remote) return alert("Заповніть усі поля."); const salaryMin=+(($("#pSalaryMin").value||0)); const salaryMax=+(($("#pSalaryMax").value||0)); if(salaryMin && salaryMax && salaryMin>salaryMax) return alert("Мін. зарплата > макс."); const currency=$("#pCur").value; const desc=$("#pDesc").value.trim(); if(desc.length<20) return alert("Опис ≥ 20 символів."); const req=$("#pReq").value.trim(); const phone=$("#pPhone").value.trim(); if(phone && !/^\+?\d[\d\s\-]{8,}$/.test(phone)) return alert("Телефон некоректний."); const email=$("#pEmail").value.trim(); if(email && !/^\S+@\S+\.\S+$/.test(email)) return alert("Email некоректний."); const tg=$("#pTG").value.trim(); const db=getDB(); db.unshift({ id:uid(), city, category, title, company, exp, employment, remote, salaryMin:salaryMin||null, salaryMax:salaryMax||null, currency:currency||"₴", posted: now, views: rand(5,25), skills:[], desc, req, contacts:{ phone, email, tg }, images:[] }); setDB(db); ctrl.lastPost=now; setCtrl(ctrl); alert("Вакансію опубліковано."); refreshCompanyOptions(); applyFilters(); };

  // Вкладки
  $("#tabSearch").onclick=()=>{ $("#postPanel").style.display="none"; window.scrollTo({top:0, behavior:"smooth"}); };
  $("#tabPost").onclick=()=>{ $("#postPanel").style.display="block"; $("#postPanel").scrollIntoView({behavior:'smooth', block:'start'}); };

  </script>
</body>
</html>
